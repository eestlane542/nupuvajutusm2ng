<!DOCTYPE html>
<html lang="et">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Punase Nupu MÃ¤ng</title>

<style>
body{
  margin:0;
  background:black;
  color:white;
  font-family:sans-serif;
  overflow:hidden;
  touch-action:none;
  user-select:none;
}

#startScreen{
  position:fixed;
  inset:0;
  background:black;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  z-index:100;
}

#startInput{
  padding:10px;
  font-size:18px;
  text-align:center;
}

#ui{
  position:fixed;
  top:10px;
  left:10px;
  z-index:10;
  pointer-events:none;
}

#counter{font-size:22px;}
#lives{font-size:18px;margin-top:5px;}

.btn{
  position:absolute;
  border-radius:50%;
  border:none;
}

#realButton{
  background:red;
  z-index:5;
}

.clone{
  background:cyan;
  opacity:0.6;
}

canvas{
  position:absolute;
  top:0;
  left:0;
  z-index:0;
}
</style>
</head>
<body>

<div id="startScreen">
  <h2>Sisesta kood</h2>
  <input id="startInput" placeholder="Kirjuta start..." />
</div>

<div id="ui">
  <div id="counter">Vajutused: 0</div>
  <div id="lives"></div>
</div>

<button id="realButton" class="btn" style="display:none;"></button>
<canvas id="canvas"></canvas>

<script>
const startScreen=document.getElementById("startScreen");
const startInput=document.getElementById("startInput");

const realBtn=document.getElementById("realButton");
const counterEl=document.getElementById("counter");
const livesEl=document.getElementById("lives");
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");

function resize(){
  canvas.width=window.innerWidth;
  canvas.height=window.innerHeight;
}
resize();
window.addEventListener("resize",resize);

/* ---------- GAME STATE ---------- */

let started=false;
let count=0;
let lives=0;
let maxLives=5;

let bouncing=false;
let vx=1.8, vy=1.8;
let size=100;

let bombs=[];
let missiles=[];
let clones=[];

let cloneMode=false;
let teleportMode=false;
let darknessMode=false;
let missileStarted=false;

let player={x:0,y:0,active:false};

/* ---------- START SYSTEM ---------- */

startInput.addEventListener("keydown",e=>{
  if(e.key==="Enter"){
    if(startInput.value==="start"){
      beginGame(0);
    }
    if(startInput.value==="start...-564454"){
      beginGame(550);
    }
  }
});

function beginGame(startScore){
  started=true;
  count=startScore;
  counterEl.textContent="Vajutused: "+count;

  startScreen.style.display="none";
  realBtn.style.display="block";

  if(count>=100) bouncing=true;
  if(count>=200){ lives=3; startBombSpawning(); }
  if(count>=300) startMissiles();
  if(count>=400) activateCloneMode();
  if(count>=500) teleportMode=true;
  if(count>=550) darknessMode=true;

  livesEl.textContent="Elud: "+lives;
}

/* ---------- INPUT ---------- */

function setPlayer(x,y){
  player.x=x;
  player.y=y;
  player.active=true;
}

document.addEventListener("mousemove",e=>setPlayer(e.clientX,e.clientY));
document.addEventListener("touchstart",e=>{
  const t=e.touches[0];
  setPlayer(t.clientX,t.clientY);
});
document.addEventListener("touchmove",e=>{
  const t=e.touches[0];
  setPlayer(t.clientX,t.clientY);
});

/* ---------- BUTTON ---------- */

let bx=window.innerWidth/2-50;
let by=window.innerHeight/2-50;

function updateRealButton(){
  realBtn.style.width=size+"px";
  realBtn.style.height=size+"px";
  realBtn.style.left=bx+"px";
  realBtn.style.top=by+"px";
}
updateRealButton();

realBtn.addEventListener("click",()=>{
  count++;
  counterEl.textContent="Vajutused: "+count;

  if(count>=100) bouncing=true;

  if(count>=200 && lives===0){
    lives=3;
    startBombSpawning();
  }

  if(count>=300) startMissiles();
  if(count>=400 && !cloneMode) activateCloneMode();
  if(count>=500) teleportMode=true;
  if(count>=550) darknessMode=true;

  if(teleportMode) teleportAway();

  livesEl.textContent="Elud: "+lives;
});

/* ---------- TELEPORT ---------- */

function teleportAway(){
  if(!player.active) return;

  let angle=Math.random()*Math.PI*2;
  let distance=80+Math.random()*40;

  bx+=Math.cos(angle)*distance;
  by+=Math.sin(angle)*distance;

  bx=Math.max(0,Math.min(window.innerWidth-size,bx));
  by=Math.max(0,Math.min(window.innerHeight-size,by));

  updateRealButton();
}

/* ---------- HEALING CLONES ---------- */

function activateCloneMode(){
  cloneMode=true;
  size=60;
  updateRealButton();

  for(let i=0;i<3;i++){
    createClone();
  }
}

function createClone(){
  const clone=document.createElement("button");
  clone.className="btn clone";
  clone.style.width=size+"px";
  clone.style.height=size+"px";
  document.body.appendChild(clone);

  let cloneObj={
    el:clone,
    x:Math.random()*window.innerWidth,
    y:Math.random()*window.innerHeight,
    vx:(Math.random()-0.5)*4,
    vy:(Math.random()-0.5)*4
  };

  clone.addEventListener("click",()=>{
    if(lives>0 && lives<maxLives){
      lives++;
      livesEl.textContent="Elud: "+lives;
    }
    clone.remove();
    clones=clones.filter(c=>c!==cloneObj);
  });

  clones.push(cloneObj);
}

function moveClones(){
  clones.forEach(c=>{
    c.x+=c.vx;
    c.y+=c.vy;

    if(c.x<=0||c.x>=window.innerWidth-size) c.vx*=-1;
    if(c.y<=0||c.y>=window.innerHeight-size) c.vy*=-1;

    c.el.style.left=c.x+"px";
    c.el.style.top=c.y+"px";
  });
}

/* ---------- MOVEMENT ---------- */

function moveButton(){
  if(!bouncing) return;

  bx+=vx;
  by+=vy;

  if(bx<=0||bx>=window.innerWidth-size) vx*=-1;
  if(by<=0||by>=window.innerHeight-size) vy*=-1;

  updateRealButton();
}

/* ---------- BOMBS ---------- */

function spawnBomb(){
  bombs.push({
    x:Math.random()*canvas.width,
    y:Math.random()*canvas.height,
    vx:(Math.random()-0.5)*3,
    vy:(Math.random()-0.5)*3,
    r:15,
    born:Date.now(),
    life:60000
  });
}

function startBombSpawning(){
  setInterval(()=>{
    if(count>=200 && bombs.length<20){
      spawnBomb();
    }
  },2000);
}

function updateBombs(){
  bombs.forEach((b,i)=>{
    if(Date.now()-b.born>b.life){
      bombs.splice(i,1);
      return;
    }

    b.x+=b.vx;
    b.y+=b.vy;

    if(b.x<0||b.x>canvas.width) b.vx*=-1;
    if(b.y<0||b.y>canvas.height) b.vy*=-1;

    if(player.active && Math.hypot(b.x-player.x,b.y-player.y)<b.r){
      loseLife();
      bombs.splice(i,1);
    }

    drawCircle(b.x,b.y,b.r,"orange");
  });
}

/* ---------- MISSILES ---------- */

function spawnMissile(){
  let side=Math.floor(Math.random()*4);
  let x,y;

  if(side===0){x=0;y=Math.random()*canvas.height;}
  if(side===1){x=canvas.width;y=Math.random()*canvas.height;}
  if(side===2){x=Math.random()*canvas.width;y=0;}
  if(side===3){x=Math.random()*canvas.width;y=canvas.height;}

  missiles.push({x,y,angle:0,speed:2,turnSpeed:0.03});
}

function startMissiles(){
  if(missileStarted) return;
  missileStarted=true;

  setInterval(()=>{
    if(count>=300) spawnMissile();
  },3000);
}

function updateMissiles(){
  missiles.forEach((m,i)=>{
    if(player.active){
      let target=Math.atan2(player.y-m.y,player.x-m.x);
      let diff=Math.atan2(Math.sin(target-m.angle),Math.cos(target-m.angle));
      if(diff>0)m.angle+=m.turnSpeed;
      else m.angle-=m.turnSpeed;
    }

    m.x+=Math.cos(m.angle)*m.speed;
    m.y+=Math.sin(m.angle)*m.speed;

    if(player.active && Math.hypot(m.x-player.x,m.y-player.y)<15){
      loseLife();
      missiles.splice(i,1);
    }

    drawCircle(m.x,m.y,10,"lime");
  });
}

/* ---------- LIFE ---------- */

function loseLife(){
  if(lives>0){
    lives--;
    livesEl.textContent="Elud: "+lives;
    if(lives<=0){
      alert("Game Over!");
      location.reload();
    }
  }
}

/* ---------- DARKNESS ---------- */

function drawDarkness(){
  ctx.fillStyle="black";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  if(player.active){
    ctx.globalCompositeOperation="destination-out";
    ctx.beginPath();
    ctx.arc(player.x,player.y,80,0,Math.PI*2);
    ctx.fill();
    ctx.globalCompositeOperation="source-over";
  }
}

function drawCircle(x,y,r,color){
  ctx.beginPath();
  ctx.arc(x,y,r,0,Math.PI*2);
  ctx.fillStyle=color;
  ctx.fill();
}

function loop(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if(started){
    moveButton();
    if(cloneMode) moveClones();
    if(count>=200) updateBombs();
    if(count>=300) updateMissiles();
    if(darknessMode) drawDarkness();
  }

  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>

